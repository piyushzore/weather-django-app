<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>Weather App Live Demo</title>
  <style>
    body{font-family:system-ui,Segoe UI,Roboto,Arial;max-width:900px;margin:24px auto;padding:0 16px}
    input,button{padding:8px;margin:4px}
    .city{display:flex;align-items:center;gap:8px;margin:6px 0}
    h1{color:#2563eb}
    pre{background:#111;color:#0f0;padding:12px;border-radius:6px}
  </style>
</head>
<body>
  <h1>✅ Weather App — Live Demo (CRUD + API)</h1>

  <h3>Add City</h3>
  <input id="newCity" placeholder="City name">
  <button onclick="addCity()">Add</button>

  <h3>All Cities</h3>
  <div id="cities"></div>

  <h3>Live Weather</h3>
  <input id="weatherCity" placeholder="Enter city name">
  <button onclick="getWeather()">Fetch Weather</button>
  <pre id="weatherResult"></pre>

<script>
const API_ROOT = '/api/';

async function api(path, opts={}){
  const res = await fetch(API_ROOT + path, Object.assign({
    headers:{'Content-Type':'application/json'}
  }, opts));
  return res;
}

async function loadCities(){
  const res = await api('cities/');
  const data = await res.json();
  const out = document.getElementById('cities');
  out.innerHTML = '';
  data.forEach(c=>{
    const div = document.createElement('div');
    div.className = 'city';
    div.innerHTML = `<strong>${c.name}</strong>
      <button onclick="edit(${c.id}, '${c.name}')">Edit</button>
      <button onclick="del(${c.id})">Delete</button>`;
    out.appendChild(div);
  });
}

async function addCity(){
  const name = document.getElementById('newCity').value.trim();
  if(!name) return alert('Enter name');
  const res = await api('cities/', {
    method:'POST',
    body: JSON.stringify({name})
  });
  if(res.ok){
    document.getElementById('newCity').value='';
    loadCities();
  } else {
    alert('Error creating city');
  }
}

function edit(id, oldName){
  const name = prompt('New name', oldName);
  if(!name) return;
  fetch('/api/cities/'+id+'/', {
    method:'PUT',
    headers:{'Content-Type':'application/json'},
    body: JSON.stringify({name})
  }).then(r=>{
    if(r.ok) loadCities();
    else alert('Update failed');
  });
}

function del(id){
  if(!confirm('Delete city?')) return;
  fetch('/api/cities/'+id+'/', {method:'DELETE'})
    .then(r=>{
      if(r.ok) loadCities();
      else alert('Delete failed');
    });
}

async function getWeather(){
  const city = document.getElementById('weatherCity').value.trim();
  if(!city) return alert('Enter city');
  const res = await api('weather/'+encodeURIComponent(city)+'/');
  const txt = await res.text();
  document.getElementById('weatherResult').textContent = txt;
}

window.onload = loadCities;
</script>
</body>
</html>
